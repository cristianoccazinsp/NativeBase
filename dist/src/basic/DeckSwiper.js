var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.DeckSwiper=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _react=_interopRequireWildcard(require("react"));var _propTypes=_interopRequireDefault(require("prop-types"));var _reactNative=require("react-native");var _clamp=_interopRequireDefault(require("clamp"));var _shoutem=require("../theme/shoutem");var _mapPropsToStyleNames=_interopRequireDefault(require("../utils/mapPropsToStyleNames"));var _jsxFileName="/Users/cristiano/Desktop/trabajo/zinspector/NativeBase/src/basic/DeckSwiper.js";function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap();var cacheNodeInterop=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop;})(nodeInterop);}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!=="object"&&typeof obj!=="function"){return{default:obj};}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}var SWIPE_THRESHOLD=120;var DeckSwiper=function(_Component){(0,_inherits2.default)(DeckSwiper,_Component);var _super=_createSuper(DeckSwiper);function DeckSwiper(props){var _this;(0,_classCallCheck2.default)(this,DeckSwiper);_this=_super.call(this,props);_this.getInitialStyle=function(){return{topCard:{position:'absolute',top:0,right:0,left:0}};};_this.state={pan:new _reactNative.Animated.ValueXY(),pan2:new _reactNative.Animated.ValueXY(),enter:new _reactNative.Animated.Value(0.8),selectedItem:_this.props.dataSource[0],selectedItem2:_this.props.dataSource[1],card1Top:true,card2Top:false,fadeAnim:new _reactNative.Animated.Value(0.8),looping:typeof _this.props.looping==='undefined'?true:_this.props.looping,disabled:_this.props.dataSource.length===0,lastCard:_this.props.dataSource.length===1};_this.setPanresponder();return _this;}(0,_createClass2.default)(DeckSwiper,[{key:"componentDidUpdate",value:function componentDidUpdate(_ref){var dataSource=_ref.dataSource;if(dataSource.length!==this.props.dataSource.length){if(dataSource.length<=1){this.setState((0,_extends2.default)({},this.state,{selectedItem:dataSource[0],selectedItem2:undefined,disabled:dataSource.length===0,lastCard:dataSource.length===1}));return;}var visibleIndex=dataSource.indexOf(this.state.selectedItem);var currentIndex=visibleIndex<0?visibleIndex+1:visibleIndex;var nextIndex=currentIndex+1===dataSource.length?0:currentIndex+1;this.setState({selectedItem:dataSource[currentIndex],selectedItem2:dataSource[nextIndex]});}}},{key:"getCardStyles",value:function getCardStyles(){var _this$state=this.state,pan=_this$state.pan,enter=_this$state.enter;var _ref2=[pan.x,pan.y],translateX=_ref2[0],translateY=_ref2[1];var rotate=pan.x.interpolate({inputRange:[-700,0,700],outputRange:['-10deg','0deg','10deg']});var opacity=pan.x.interpolate({inputRange:[-320,0,320],outputRange:[0.9,1,0.9]});var scale=enter;var animatedCardStyles={transform:[{translateX:translateX},{translateY:translateY},{rotate:rotate}],opacity:opacity};var animatedCardStyles2={transform:[{scale:scale}]};return[animatedCardStyles,animatedCardStyles2];}},{key:"setPanresponder",value:function setPanresponder(){var _this2=this;this._panResponder=_reactNative.PanResponder.create({onMoveShouldSetResponderCapture:function onMoveShouldSetResponderCapture(){return true;},onMoveShouldSetPanResponderCapture:function onMoveShouldSetPanResponderCapture(evt,gestureState){return Math.abs(gestureState.dx)>5;},onPanResponderGrant:function onPanResponderGrant(){_this2.state.pan.setOffset({x:_this2.state.pan.x._value,y:_this2.state.pan.y._value});_this2.state.pan.setValue({x:0,y:0});},onPanResponderMove:function onPanResponderMove(e,gestureState){if(gestureState.dx>20){if(_this2.props.onSwiping){_this2.props.onSwiping('right',gestureState.dx);}}else if(gestureState.dx<-20){if(_this2.props.onSwiping){_this2.props.onSwiping('left',gestureState.dx);}}var val=Math.abs(gestureState.dx*0.0013);if(val>0.2){val=0.2;}_reactNative.Animated.timing(_this2.state.fadeAnim,{toValue:0.8+val,useNativeDriver:false}).start();_reactNative.Animated.spring(_this2.state.enter,{toValue:0.8+val,friction:7,useNativeDriver:false}).start();_reactNative.Animated.event([null,{dx:_this2.state.pan.x}],{useNativeDriver:false})(e,gestureState);},onPanResponderRelease:function onPanResponderRelease(e,_ref3){var vx=_ref3.vx,vy=_ref3.vy;if(_this2.props.onSwiping){_this2.props.onSwiping(null);}var velocity;if(vx>=0){velocity=(0,_clamp.default)(vx,4.5,10);}else if(vx<0){velocity=(0,_clamp.default)(vx*-1,4.5,10)*-1;}if(Math.abs(_this2.state.pan.x._value)>SWIPE_THRESHOLD){if(velocity>0){_this2.props.onSwipeRight?_this2.props.onSwipeRight(_this2.state.selectedItem):undefined;_this2.selectNext();}else{_this2.props.onSwipeLeft?_this2.props.onSwipeLeft(_this2.state.selectedItem):undefined;_this2.selectNext();}_reactNative.Animated.decay(_this2.state.pan,{velocity:{x:velocity,y:vy},deceleration:0.98,useNativeDriver:false}).start(_this2._resetState.bind(_this2));}else{_reactNative.Animated.spring(_this2.state.pan,{toValue:{x:0,y:0},friction:4,useNativeDriver:false}).start();}}});}},{key:"_resetState",value:function _resetState(){this.state.pan.setValue({x:0,y:0});this.state.enter.setValue(0.8);this.state.fadeAnim.setValue(0.8);this.setState({card1Top:!this.state.card1Top,card2Top:!this.state.card2Top});if(this.props.onSwiping){this.props.onSwiping(null);}}},{key:"swipeRight",value:function swipeRight(){var _this3=this;if(this.props.onSwiping){this.props.onSwiping('right');}setTimeout(function(){_reactNative.Animated.timing(_this3.state.fadeAnim,{toValue:1,useNativeDriver:false}).start();_reactNative.Animated.spring(_this3.state.enter,{toValue:1,friction:7,useNativeDriver:false}).start();_this3.selectNext();_reactNative.Animated.decay(_this3.state.pan,{velocity:{x:8,y:1},deceleration:0.98,useNativeDriver:false}).start(_this3._resetState.bind(_this3));},300);}},{key:"swipeLeft",value:function swipeLeft(){var _this4=this;if(this.props.onSwiping){this.props.onSwiping('left');}setTimeout(function(){_reactNative.Animated.timing(_this4.state.fadeAnim,{toValue:1,useNativeDriver:false}).start();_reactNative.Animated.spring(_this4.state.enter,{toValue:1,friction:7,useNativeDriver:false}).start();_this4.selectNext();_reactNative.Animated.decay(_this4.state.pan,{velocity:{x:-8,y:1},deceleration:0.98,useNativeDriver:false}).start(_this4._resetState.bind(_this4));},300);}},{key:"selectNext",value:function selectNext(){var _this5=this;var dataSource=this.props.dataSource;var currentIndex=dataSource.indexOf(this.state.selectedItem);if(!this.state.looping){if(currentIndex===dataSource.length-1){return this.setState({disabled:true});}else if(currentIndex===dataSource.length-2){return setTimeout(function(){_this5.setState({selectedItem:dataSource[currentIndex+1]});setTimeout(function(){_this5.setState({lastCard:true});},350);},50);}}var nextIndexes=this.findNextIndexes(currentIndex);setTimeout(function(){_this5.setState({selectedItem:_this5.props.dataSource[nextIndexes[0]]});setTimeout(function(){_this5.setState({selectedItem2:_this5.props.dataSource[nextIndexes[1]]});},350);},50);return null;}},{key:"findNextIndexes",value:function findNextIndexes(currentIndex){var newIdx=currentIndex+1;var newIdx2=currentIndex+2;if(newIdx2>this.props.dataSource.length-1&&newIdx===this.props.dataSource.length-1){return[newIdx,0];}else if(newIdx>this.props.dataSource.length-1){return[0,1];}return[newIdx,newIdx2];}},{key:"render",value:function render(){if(this.state.disabled){return _react.default.createElement(_reactNative.View,{style:{position:'relative',flexDirection:'column'},__self:this,__source:{fileName:_jsxFileName,lineNumber:295,columnNumber:9}},_react.default.createElement(_reactNative.View,{__self:this,__source:{fileName:_jsxFileName,lineNumber:296,columnNumber:12}},this.props.renderEmpty&&this.props.renderEmpty()));}else if(this.state.lastCard){return _react.default.createElement(_reactNative.View,{style:{position:'relative',flexDirection:'column'},__self:this,__source:{fileName:_jsxFileName,lineNumber:302,columnNumber:9}},this.state.selectedItem===undefined?_react.default.createElement(_reactNative.View,{__self:this,__source:{fileName:_jsxFileName,lineNumber:304,columnNumber:13}}):_react.default.createElement(_reactNative.View,{__self:this,__source:{fileName:_jsxFileName,lineNumber:306,columnNumber:13}},_react.default.createElement(_reactNative.Animated.View,(0,_extends2.default)({style:[this.getCardStyles()[1],this.getInitialStyle().topCard,{opacity:this.state.fadeAnim}]},this._panResponder.panHandlers,{__self:this,__source:{fileName:_jsxFileName,lineNumber:307,columnNumber:15}}),this.props.renderEmpty&&this.props.renderEmpty()),_react.default.createElement(_reactNative.Animated.View,(0,_extends2.default)({style:[this.getCardStyles()[0],this.getInitialStyle().topCard]},this._panResponder.panHandlers,{__self:this,__source:{fileName:_jsxFileName,lineNumber:316,columnNumber:15}}),this.props.renderItem(this.state.selectedItem))));}return _react.default.createElement(_reactNative.View,{style:{position:'relative',flexDirection:'column'},__self:this,__source:{fileName:_jsxFileName,lineNumber:330,columnNumber:7}},this.state.selectedItem===undefined?_react.default.createElement(_reactNative.View,{__self:this,__source:{fileName:_jsxFileName,lineNumber:332,columnNumber:11}}):_react.default.createElement(_reactNative.View,{__self:this,__source:{fileName:_jsxFileName,lineNumber:334,columnNumber:11}},_react.default.createElement(_reactNative.Animated.View,(0,_extends2.default)({style:[this.getCardStyles()[1],this.getInitialStyle().topCard,{opacity:this.state.fadeAnim}]},this._panResponder.panHandlers,{__self:this,__source:{fileName:_jsxFileName,lineNumber:335,columnNumber:13}}),this.props.renderBottom?this.props.renderBottom(this.state.selectedItem2):this.props.renderItem(this.state.selectedItem2)),_react.default.createElement(_reactNative.Animated.View,(0,_extends2.default)({style:[this.getCardStyles()[0],this.getInitialStyle().topCard]},this._panResponder.panHandlers,{__self:this,__source:{fileName:_jsxFileName,lineNumber:346,columnNumber:13}}),this.props.renderTop?this.props.renderTop(this.state.selectedItem):this.props.renderItem(this.state.selectedItem))));}}]);return DeckSwiper;}(_react.Component);DeckSwiper.propTypes=(0,_extends2.default)({},_reactNative.ViewPropTypes,{style:_propTypes.default.oneOfType([_propTypes.default.object,_propTypes.default.number,_propTypes.default.array]),dataSource:_propTypes.default.array});var StyledDeckSwiper=(0,_shoutem.connectStyle)('NativeBase.DeckSwiper',{},_mapPropsToStyleNames.default)(DeckSwiper);exports.DeckSwiper=StyledDeckSwiper;
//# sourceMappingURL=DeckSwiper.js.map